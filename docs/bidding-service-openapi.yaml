openapi: 3.0.3
info:
  title: Bidding Service API
  description: |
    Bidding Service manages all bid-related operations for projects.
    Organizations can submit, update, and withdraw bids. Clients can accept or reject bids.
  version: 1.0.0
  contact:
    name: BidSphere Team

servers:
  - url: http://localhost:8083
    description: Local development
  - url: http://localhost:8080/api/bids
    description: Via NGINX Gateway

tags:
  - name: Bids
    description: Bid management operations
  - name: Statistics
    description: Bid statistics and analytics

security:
  - BearerAuth: []

paths:
  /api/bids:
    post:
      tags:
        - Bids
      summary: Submit a new bid
      description: Organizations submit bids on projects
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitBidRequest'
      responses:
        '201':
          description: Bid submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'

  /api/bids/project/{projectId}:
    get:
      tags:
        - Bids
      summary: Get bids for a project
      description: Retrieve all bids for a specific project with filtering and sorting
      parameters:
        - $ref: '#/components/parameters/ProjectId'
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACCEPTED, REJECTED, WITHDRAWN]
        - name: sort
          in: query
          schema:
            type: string
            enum: [price_asc, price_desc, date_asc, date_desc]
            default: date_desc
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Bids retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidListResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/bids/my-bids:
    get:
      tags:
        - Bids
      summary: Get my bids (Organization)
      description: Retrieve all bids submitted by the authenticated organization
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, ACCEPTED, REJECTED, WITHDRAWN]
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: My bids retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MyBidsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/bids/{bidId}:
    get:
      tags:
        - Bids
      summary: Get single bid
      description: Retrieve details of a specific bid
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BidId'
      responses:
        '200':
          description: Bid retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidDetailResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Bids
      summary: Update bid
      description: Update an existing bid (only PENDING bids)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BidId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBidRequest'
      responses:
        '200':
          description: Bid updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Bids
      summary: Withdraw bid
      description: Withdraw a bid (only PENDING bids)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BidId'
      responses:
        '200':
          description: Bid withdrawn successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/bids/{bidId}/accept:
    post:
      tags:
        - Bids
      summary: Accept bid (Client)
      description: Client accepts a bid on their project
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BidId'
      responses:
        '200':
          description: Bid accepted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidActionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/bids/{bidId}/reject:
    post:
      tags:
        - Bids
      summary: Reject bid (Client)
      description: Client rejects a bid on their project
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/BidId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RejectBidRequest'
      responses:
        '200':
          description: Bid rejected successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/bids/project/{projectId}/stats:
    get:
      tags:
        - Statistics
      summary: Get bid statistics for project
      description: Retrieve statistics about bids for a specific project
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BidStatsResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/bids/health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the service is running
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    BidId:
      name: bidId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ProjectId:
      name: projectId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    Page:
      name: page
      in: query
      schema:
        type: integer
        default: 0
        minimum: 0
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

  schemas:
    SubmitBidRequest:
      type: object
      required:
        - projectId
        - proposedPrice
        - estimatedDuration
        - proposal
      properties:
        projectId:
          type: string
          format: uuid
        proposedPrice:
          type: number
          format: double
          minimum: 0.01
          example: 5000.00
        estimatedDuration:
          type: integer
          minimum: 1
          description: Duration in days
          example: 30
        proposal:
          type: string
          minLength: 50
          example: "Detailed proposal explaining why we are the best fit..."

    UpdateBidRequest:
      type: object
      required:
        - proposedPrice
        - estimatedDuration
        - proposal
      properties:
        proposedPrice:
          type: number
          format: double
          minimum: 0.01
        estimatedDuration:
          type: integer
          minimum: 1
        proposal:
          type: string
          minLength: 50

    RejectBidRequest:
      type: object
      properties:
        reason:
          type: string
          example: "Budget constraints"

    Bid:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        bidderId:
          type: string
          format: uuid
        bidderName:
          type: string
        bidderType:
          type: string
          enum: [ORGANIZATION, INDIVIDUAL]
        proposedPrice:
          type: number
          format: double
        estimatedDuration:
          type: integer
        proposal:
          type: string
        status:
          type: string
          enum: [PENDING, ACCEPTED, REJECTED, WITHDRAWN]
        submittedAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        ranking:
          type: integer
          description: Rank among all bids (1 = lowest price)

    BidResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Bid submitted successfully"
        data:
          $ref: '#/components/schemas/Bid'

    BidDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          allOf:
            - $ref: '#/components/schemas/Bid'
            - type: object
              properties:
                projectTitle:
                  type: string
                attachments:
                  type: array
                  items:
                    type: object

    BidListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            content:
              type: array
              items:
                $ref: '#/components/schemas/Bid'
            totalElements:
              type: integer
            totalPages:
              type: integer
            currentPage:
              type: integer
            pageSize:
              type: integer

    MyBidsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            content:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  projectId:
                    type: string
                  projectTitle:
                    type: string
                  proposedPrice:
                    type: number
                  estimatedDuration:
                    type: integer
                  status:
                    type: string
                  submittedAt:
                    type: string
                    format: date-time
                  ranking:
                    type: integer
                  totalBids:
                    type: integer
            totalElements:
              type: integer
            totalPages:
              type: integer
            currentPage:
              type: integer

    BidActionResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            id:
              type: string
            status:
              type: string
            acceptedAt:
              type: string
              format: date-time

    BidStatsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            totalBids:
              type: integer
            pendingBids:
              type: integer
            acceptedBids:
              type: integer
            rejectedBids:
              type: integer
            averageBidAmount:
              type: number
              format: double
            lowestBid:
              type: number
              format: double
            highestBid:
              type: number
              format: double

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          nullable: true

    HealthResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
        data:
          nullable: true

  responses:
    BadRequest:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized - missing or invalid JWT
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict - duplicate resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
